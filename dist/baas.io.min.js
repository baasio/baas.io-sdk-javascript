(function(){function t(t){var e=/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/;return t?e.test(t):!1}function e(t){tail=[];var e=[];if(t instanceof Array)for(i in t)e=t[i],e instanceof Array&&e.length>1&&tail.push(e[0]+"="+encodeURIComponent(e[1]));else for(var n in t)if(t.hasOwnProperty(n)){var o=t[n];if(o instanceof Array)for(i in o)e=o[i],tail.push(n+"="+encodeURIComponent(e));else tail.push(n+"="+encodeURIComponent(o))}return tail.join("&")}window.console=window.console||{},window.console.log=window.console.log||function(){},window.Usergrid=window.Usergrid||{},Usergrid=Usergrid||{},Usergrid.SDK_VERSION="0.10.03",Usergrid.Client=function(t){this.URI="https://api.usergrid.com",this.orgName=t.orgName,this.appName=t.appName,this.buildCurl=t.buildCurl||!1,this.logging=t.logging||!1,this._callTimeout=t.callTimeout||3e4,this._callTimeoutCallback=t.callTimeoutCallback||null,this.logoutCallback=t.logoutCallback||null},Usergrid.Client.prototype.request=function(t,i){var n=this,o=t.method||"GET",r=t.endpoint,s=t.body||{},l=t.qs||{},a=t.mQuery||!1;if(a)var u=this.URI+"/"+r;else var u=this.URI+"/"+this.orgName+"/"+this.appName+"/"+r;n.getToken()&&(l.access_token=n.getToken());var c=e(l);c&&(u+="?"+c),s=JSON.stringify(s);var g=new XMLHttpRequest;g.open(o,u,!0),s&&g.setRequestHeader("Content-Type","application/json"),g.onerror=function(){n._end=(new Date).getTime(),n.logging&&console.log("success (time: "+n.calcTimeDiff()+"): "+o+" "+u),n.logging&&console.log("Error: API call failed at the network level."),clearTimeout(d);var t=!0;"function"==typeof i&&i(t,data)},g.onload=function(t){if(n._end=(new Date).getTime(),n.logging&&console.log("success (time: "+n.calcTimeDiff()+"): "+o+" "+u),clearTimeout(d),t=JSON.parse(g.responseText),200!=g.status){var e=t.error,r=t.error_description;if(n.logging&&console.log("Error ("+g.status+")("+e+"): "+r),("auth_expired_session_token"==e||"unauthorized"==e||"auth_missing_credentials"==e||"auth_invalid"==e)&&"function"==typeof n.logoutCallback)return n.logoutCallback(!0,t);"function"==typeof i&&i(!0,t)}else"function"==typeof i&&i(!1,t)};var d=setTimeout(function(){g.abort(),"function"===n._callTimeoutCallback?n._callTimeoutCallback("API CALL TIMEOUT"):n.callback("API CALL TIMEOUT")},n._callTimeout);if(this.logging&&console.log("calling: "+o+" "+u),this.buildCurl){var f={uri:u,body:s,method:o};this.buildCurlCall(f)}this._start=(new Date).getTime(),g.send(s)},Usergrid.Client.prototype.createEntity=function(t,e){var t={client:this,data:t},i=new Usergrid.Entity(t);i.save(function(t){"function"==typeof e&&e(t,i)})},Usergrid.Client.prototype.createCollection=function(t,e){t.client=this;var i=new Usergrid.Collection(t,function(t){"function"==typeof e&&e(t,i)})},Usergrid.Client.prototype.createUserActivity=function(t,e,i){e.type="users/"+t+"/activities";var e={client:this,data:e},n=new Usergrid.Entity(e);n.save(function(t){"function"==typeof i&&i(t,n)})},Usergrid.Client.prototype.calcTimeDiff=function(){var t=0,e=this._end-this._start;try{t=(e/10/60).toFixed(2)}catch(i){return 0}return t},Usergrid.Client.prototype.setToken=function(t){this.token=t,"undefined"!=typeof Storage&&localStorage.setItem("token",t)},Usergrid.Client.prototype.getToken=function(){return this.token?this.token:"undefined"!=typeof Storage?localStorage.getItem("token"):null},Usergrid.Client.prototype.login=function(t,e,i){var n=this,o={method:"GET",endpoint:"token",qs:{username:t,password:e,grant_type:"password"}};this.request(o,function(t,e){var o={};t&&n.logging?console.log("error trying to log user in"):(o=new Usergrid.Entity("users",e.user),n.setToken(e.access_token)),"function"==typeof i&&i(t,e,o)})},Usergrid.Client.prototype.loginFacebook=function(t,e){var i=this,n={method:"GET",endpoint:"auth/facebook",qs:{fb_access_token:t}};this.request(n,function(t,n){var o={};t&&i.logging?console.log("error trying to log user in"):(o=new Usergrid.Entity("users",n.user),i.setToken(n.access_token)),"function"==typeof e&&e(t,n,o)})},Usergrid.Client.prototype.getLoggedInUser=function(t){if(this.getToken){var e=this,i={method:"GET",endpoint:"users/me"};this.request(i,function(i,n){if(i)e.logging&&console.log("error trying to log user in"),"function"==typeof t&&t(i,n,null);else{var o={client:e,data:n.entities[0]},r=new Usergrid.Entity(o);"function"==typeof t&&t(i,n,r)}})}else t(!0,null,null)},Usergrid.Client.prototype.isLoggedIn=function(){return this.getToken()?!0:!1},Usergrid.Client.prototype.logout=function(){this.setToken(null)},Usergrid.Client.prototype.buildCurlCall=function(t){var e="curl",i=(t.method||"GET").toUpperCase(),n=t.body||{},o=t.uri;return e+="POST"===i?" -X POST":"PUT"===i?" -X PUT":"DELETE"===i?" -X DELETE":" -X GET",e+=" "+o,n=JSON.stringify(n),'"{}"'!==n&&"GET"!==i&&"DELETE"!==i&&(e+=" -d '"+n+"'"),console.log(e),e},Usergrid.Entity=function(t){this._client=t.client,this._data=t.data||{}},Usergrid.Entity.prototype.get=function(t){return t?this._data[t]:this._data},Usergrid.Entity.prototype.set=function(t,e){if("object"==typeof t)for(var i in t)this._data[i]=t[i];else"string"==typeof t?null===e?delete this._data[t]:this._data[t]=e:this._data=null},Usergrid.Entity.prototype.save=function(e){var i=this.get("type"),n="POST";t(this.get("uuid"))&&(n="PUT",i+="/"+this.get("uuid"));var o=this,r={},s=this.get();for(var l in s)"metadata"!==l&&"created"!==l&&"modified"!==l&&"type"!==l&&"activatted"!==l&&(r[l]=s[l]);var a={method:n,endpoint:i,body:r};this._client.request(a,function(t,n){if(t&&o._client.logging){if(console.log("could not save entity"),"function"==typeof e)return e(t,n,o)}else{if(n.entities.length){var r=n.entities[0];o.set(r)}var l="users"===i&&s.oldpassword&&s.newpassword;if(l){var a={};a.oldpassword=s.oldpassword,a.newpassword=s.newpassword,this._client.request({method:"PUT",endpoint:i,body:a},function(t,i){t&&o._client.logging&&console.log("could not update user"),o.set("oldpassword",null),o.set("newpassword",null),"function"==typeof e&&e(t,i,o)})}else"function"==typeof e&&e(t,n,o)}})},Usergrid.Entity.prototype.fetch=function(t){var e=this.get("type"),i=this;if(this.get("uuid"))e+="/"+this.get("uuid");else if("users"===e){if(this.get("username"))e+="/"+this.get("username");else if("function"==typeof t){var n="cannot fetch entity, no username specified";return i._client.logging&&console.log(n),t(!0,n,i)}}else if(this.get("name"))e+="/"+this.get("name");else if("function"==typeof t){var n="cannot fetch entity, no name specified";return i._client.logging&&console.log(n),t(!0,n,i)}var o={method:"GET",endpoint:e};this._client.request(o,function(e,n){if(e&&i._client.logging)console.log("could not get entity");else if(n.user)i.set(n.user);else if(n.entities.length){var o=n.entities[0];i.set(o)}"function"==typeof t&&t(e,n,i)})},Usergrid.Entity.prototype.destroy=function(e){var i=this.get("type");if(t(this.get("uuid")))i+="/"+this.get("uuid");else if("function"==typeof e){var n="Error trying to delete object - no uuid specified.";o._client.logging&&console.log(n),e(!0,n)}var o=this,r={method:"DELETE",endpoint:i};this._client.request(r,function(t,i){t&&o._client.logging?console.log("entity could not be deleted"):o.set(null),"function"==typeof e&&e(t,i)})},Usergrid.Collection=function(t,e){this._client=t.client,this._type=t.type,this.qs=t.qs||{},this._list=[],this._iterator=-1,this._previous=[],this._next=null,this._cursor=null,this.fetch(e)},Usergrid.Collection.prototype.fetch=function(t){var e=this,i=this.qs;this._cursor?i.cursor=this._cursor:delete i.cursor;var n={method:"GET",endpoint:this._type,qs:this.qs};this._client.request(n,function(i,n){if(i&&e._client.logging)console.log("error getting collection");else{var o=n.cursor||null;if(e.saveCursor(o),n.entities){e.resetEntityPointer();var r=n.entities.length;e._list=[];for(var s=0;r>s;s++){var l=n.entities[s].uuid;if(l){var a=n.entities[s]||{},u={type:e._type,client:e._client,uuid:l,data:a},c=new Usergrid.Entity(u),g=e._list.length;e._list[g]=c}}}}"function"==typeof t&&t(i,n)})},Usergrid.Collection.prototype.addEntity=function(t,e){var i=this;t.type=this._type,this._client.createEntity(t,function(t,n){if(!t){var o=i._list.length;i._list[o]=n}"function"==typeof e&&e(t,n)})},Usergrid.Collection.prototype.destroyEntity=function(t,e){var i=this;t.destroy(function(t,n){t?(i._client.logging&&console.log("could not destroy entity"),"function"==typeof e&&e(t,n)):i.fetch(e)})},Usergrid.Collection.prototype.getEntityByUUID=function(t,e){var i={data:{type:this._type,uuid:t},client:this._client},n=new Usergrid.Entity(i);n.fetch(e)},Usergrid.Collection.prototype.getFirstEntity=function(){var t=this._list.length;return t>0?this._list[0]:null},Usergrid.Collection.prototype.getLastEntity=function(){var t=this._list.length;return t>0?this._list[t-1]:null},Usergrid.Collection.prototype.hasNextEntity=function(){var t=this._iterator+1,e=t>=0&&this._list.length>t;return e?!0:!1},Usergrid.Collection.prototype.getNextEntity=function(){this._iterator++;var t=this._iterator>=0&&this._iterator<=this._list.length;return t?this._list[this._iterator]:!1},Usergrid.Collection.prototype.hasPrevEntity=function(){var t=this._iterator-1,e=t>=0&&this._list.length>t;return e?!0:!1},Usergrid.Collection.prototype.getPrevEntity=function(){this._iterator--;var t=this._iterator>=0&&this._iterator<=this._list.length;return t?this.list[this._iterator]:!1},Usergrid.Collection.prototype.resetEntityPointer=function(){this._iterator=-1},Usergrid.Collection.prototype.saveCursor=function(t){this._next!==t&&(this._next=t)},Usergrid.Collection.prototype.resetPaging=function(){this._previous=[],this._next=null,this._cursor=null},Usergrid.Collection.prototype.hasNextPage=function(){return this._next},Usergrid.Collection.prototype.getNextPage=function(t){this.hasNextPage()&&(this._previous.push(this._cursor),this._cursor=this._next,this._list=[],this.fetch(t))},Usergrid.Collection.prototype.hasPreviousPage=function(){return this._previous.length>0},Usergrid.Collection.prototype.getPreviousPage=function(t){this.hasPreviousPage()&&(this._next=null,this._cursor=this._previous.pop(),this._list=[],this.fetch(t))},Usergrid.validation=function(){function t(t,e){return h.test(t)&&d(t,4,80)?!0:(e&&"function"==typeof e&&e(this.getUsernameAllowedChars()),!1)}function e(){return"Length: min 4, max 80. Allowed: A-Z, a-z, 0-9, dot, and dash"}function i(t,e){return p.test(t)&&d(t,4,80)?!0:(e&&"function"==typeof e&&e(this.getNameAllowedChars()),!1)}function n(){return"Length: min 4, max 80. Allowed: A-Z, a-z, 0-9, ~ @ # % ^ & * ( ) - _ = + [ ] { } \\ | ; : ' \" , . / ? !"}function o(t,e){return _.test(t)&&d(t,5,16)?!0:(e&&"function"==typeof e&&e(this.getPasswordAllowedChars()),!1)}function r(){return"Length: min 5, max 16. Allowed: A-Z, a-z, 0-9, ~ @ # % ^ & * ( ) - _ = + [ ] { } \\ | ; : ' \" , . < > / ? !"}function s(t,e){return y.test(t)&&d(t,4,80)?!0:(e&&"function"==typeof e&&e(this.getEmailAllowedChars()),!1)}function l(){return"Email must be in standard form: e.g. example@Usergrid.com"}function a(t,e){return v.test(t)&&d(t,4,80)?!0:(e&&"function"==typeof e&&e(this.getPathAllowedChars()),!1)}function u(){return"Length: min 4, max 80. Allowed: /, a-z, 0-9, dot, and dash"}function c(t,e){return m.test(t)&&d(t,4,80)?!0:(e&&"function"==typeof e&&e(this.getTitleAllowedChars()),!1)}function g(){return"Length: min 4, max 80. Allowed: space, A-Z, a-z, 0-9, dot, dash, /, !, and ?"}function d(t,e,i){return t.length>i||e>t.length?!1:!0}function f(t){var e=/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/;return t?e.test(t):!1}var h=RegExp("^([0-9a-zA-Z.-])+$"),p=RegExp("^([0-9a-zA-Z@#$%^&!?;:.,'\"~*-=+_[\\](){}/\\ |])+$"),y=RegExp("^(([0-9a-zA-Z]+[_+.-]?)+@[0-9a-zA-Z]+[0-9,a-z,A-Z,.,-]*(.){1}[a-zA-Z]{2,4})+$"),_=RegExp("^([0-9a-zA-Z@#$%^&!?<>;:.,'\"~*-=+_[\\](){}/\\ |])+$"),v=RegExp("^([0-9a-z./-])+$"),m=RegExp("^([0-9a-zA-Z.!-?/])+$");return{validateUsername:t,getUsernameAllowedChars:e,validateName:i,getNameAllowedChars:n,validatePassword:o,getPasswordAllowedChars:r,validateEmail:s,getEmailAllowedChars:l,validatePath:a,getPathAllowedChars:u,validateTitle:c,getTitleAllowedChars:g,isUUID:f}}();var n=this,o=n.baasio||{};o=Usergrid,o.VERSION="0.1.0","undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=o),exports.baasio=o):n.baasio=o}).call(this);